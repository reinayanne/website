<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Manager Julie | Language Guru</title>

<link rel="icon" type="image/png" sizes="64x64" href="adminfavicon.ico">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root{
  --pink:#ff4fa3;
  --pink-light:#ff7bbf;
  --glass-bg:rgba(255,123,191,.18);
  --glass-border:rgba(255,255,255,.25);
  --text-main:#ffffff;
  --shadow-glow:0 8px 32px rgba(255,79,163,.3);
  --success-green:#2ecc71;
  --warning-orange:#f39c12;
  --info-blue:#3498db;
  --purple:#9b59b6;
  --teal:#1abc9c;
  --danger-red:#e74c3c;
}

*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}

html{font-size:16px;-webkit-text-size-adjust:100%}

body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  background:url("adminbackground.png") center/cover fixed no-repeat;
  color:var(--text-main);
  min-height:100vh;
  overflow-x:hidden;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}

a{text-decoration:none;color:inherit}

::-webkit-scrollbar{width:8px}
::-webkit-scrollbar-track{background:rgba(255,79,163,.15)}
::-webkit-scrollbar-thumb{
  background:linear-gradient(180deg,#ff4fa3,#ff7bbf);
  border-radius:10px;
}

#loader{
  position:fixed;
  inset:0;
  background:var(--pink-light);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
  transition:.4s ease;
}
#loader.fade-out{opacity:0;visibility:hidden}
.loader-content{display:flex;flex-direction:column;align-items:center;}
.loader-content img{width:clamp(120px,30vw,190px);margin-bottom:18px}
.arc-spinner{
  width:clamp(30px,8vw,38px);
  height:clamp(30px,8vw,38px);
  border-radius:50%;
  border:4px solid rgba(255,255,255,.25);
  border-top-color:#fff;
  animation:spin .65s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}

header{
  position:sticky;top:0;z-index:1000;
  display:flex;justify-content:space-between;align-items:center;
  padding:clamp(10px,3vw,18px) clamp(15px,4vw,26px);
  backdrop-filter:blur(18px);
  background:linear-gradient(270deg,#ff4fa3,#ff7bbf,#ffb3d9);
  background-size:400% 400%;
  animation:flow 12s ease infinite;
}
@keyframes flow{
  0%{background-position:0%}
  50%{background-position:100%}
  100%{background-position:0%}
}
.header-left{display:flex;align-items:center;gap:clamp(8px,2vw,14px);}
.header-left img{height:clamp(36px,10vw,46px)}

.motto{
  font-size:clamp(14px,3vw,18px);
  font-weight:600;font-style:italic;
  display:flex;align-items:center;gap:8px;white-space:nowrap;
}
.motto i{opacity:.95;font-size:clamp(14px,3vw,17px);}

.header-icons{display:flex;align-items:center;position:relative}
.header-icons a{
  width:clamp(36px,10vw,42px);
  height:clamp(36px,10vw,42px);
  display:inline-flex;
  align-items:center;justify-content:center;
  border-radius:14px;margin-left:clamp(5px,2vw,10px);
  transition:.3s;position:relative;
}
.header-icons i{font-size:clamp(16px,4vw,18px)}
.header-icons a:hover{box-shadow:0 0 14px rgba(255,79,163,.8)}

/* Notification Badge */
.notification-badge{
  position:absolute;
  top:-2px;
  right:-2px;
  width:20px;
  height:20px;
  background:var(--danger-red);
  color:#fff;
  font-size:11px;
  font-weight:700;
  border-radius:50%;
  display:none;
  align-items:center;
  justify-content:center;
  border:2px solid #fff;
  animation:pulse-badge 2s infinite;
  z-index:10;
}
.notification-badge.show{display:flex}
@keyframes pulse-badge{
  0%,100%{transform:scale(1)}
  50%{transform:scale(1.1)}
}

main{
  max-width:1400px;
  margin:0 auto;
  padding:clamp(10px,3vw,20px);
}

/* WELCOME SECTION */
.welcome-section{
  background:var(--glass-bg);
  backdrop-filter:blur(10px);
  border:1px solid var(--glass-border);
  border-radius:20px;
  padding:clamp(20px,5vw,30px);
  margin-bottom:20px;
  text-align:center;
  box-shadow:var(--shadow-glow);
}

.welcome-section h1{
  font-family:'Orbitron',sans-serif;
  font-size:clamp(1.4rem,5vw,2.5rem);
  margin-bottom:15px;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:clamp(8px,2vw,15px);
  flex-wrap:wrap;
}

.welcome-section p{
  opacity:.9;
  max-width:700px;
  margin:0 auto 20px;
  line-height:1.6;
  font-size:clamp(0.9rem,2.5vw,1rem);
}

/* LANGUAGE SELECTOR */
.lang-selector{
  display:flex;
  gap:clamp(8px,2vw,15px);
  justify-content:center;
  flex-wrap:wrap;
  margin-top:20px;
}

.lang-btn{
  padding:clamp(10px,3vw,15px) clamp(12px,3vw,25px);
  background:rgba(255,255,255,.1);
  border:2px solid rgba(255,255,255,.2);
  border-radius:15px;
  color:#fff;
  cursor:pointer;
  transition:all .3s;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:8px;
  min-width:clamp(80px,20vw,120px);
  touch-action:manipulation;
}

.lang-btn:hover, .lang-btn.active{
  background:var(--pink);
  border-color:var(--pink-light);
  transform:translateY(-5px);
  box-shadow:0 10px 30px rgba(255,79,163,.4);
}

.lang-flag{
  font-size:clamp(1.5rem,5vw,2rem);
}

.lang-name{
  font-weight:600;
  font-size:clamp(0.75rem,2vw,0.9rem);
}

/* MAIN DASHBOARD */
.dashboard{
  display:grid;
  grid-template-columns:300px 1fr;
  gap:20px;
}

/* SIDEBAR */
.sidebar{
  display:flex;
  flex-direction:column;
  gap:15px;
}

.progress-card{
  background:var(--glass-bg);
  backdrop-filter:blur(10px);
  border:1px solid var(--glass-border);
  border-radius:20px;
  padding:clamp(15px,4vw,20px);
  box-shadow:var(--shadow-glow);
}

.progress-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:15px;
  flex-wrap:wrap;
  gap:10px;
}

.progress-title{
  font-family:'Orbitron',sans-serif;
  font-size:clamp(0.95rem,3vw,1.1rem);
}

.streak-badge{
  background:linear-gradient(135deg,var(--warning-orange),#e67e22);
  padding:5px 15px;
  border-radius:20px;
  font-size:clamp(0.75rem,2vw,0.85rem);
  font-weight:700;
  display:flex;
  align-items:center;
  gap:5px;
}

.progress-bar{
  width:100%;
  height:12px;
  background:rgba(255,255,255,.1);
  border-radius:10px;
  overflow:hidden;
  margin-bottom:10px;
}

.progress-fill{
  height:100%;
  background:linear-gradient(90deg,var(--success-green),#27ae60);
  border-radius:10px;
  transition:width .5s ease;
}

.level-info{
  display:flex;
  justify-content:space-between;
  font-size:clamp(0.75rem,2vw,0.85rem);
  opacity:.8;
}

/* SKILL BARS */
.skill-item{
  margin-bottom:15px;
}

.skill-label{
  display:flex;
  justify-content:space-between;
  margin-bottom:8px;
  font-size:clamp(0.8rem,2.5vw,0.9rem);
}

.skill-bar{
  height:8px;
  background:rgba(255,255,255,.1);
  border-radius:5px;
  overflow:hidden;
}

.skill-fill{
  height:100%;
  border-radius:5px;
  transition:width .5s ease;
}

.skill-speaking{background:var(--info-blue)}
.skill-listening{background:var(--purple)}
.skill-reading{background:var(--success-green)}
.skill-writing{background:var(--warning-orange)}

/* LEARNING MODES */
.learning-modes{
  display:flex;
  flex-direction:column;
  gap:10px;
}

.mode-btn{
  padding:clamp(12px,3vw,15px);
  background:rgba(255,255,255,.05);
  border:2px solid transparent;
  border-radius:12px;
  color:#fff;
  cursor:pointer;
  transition:all .3s;
  display:flex;
  align-items:center;
  gap:12px;
  text-align:left;
  touch-action:manipulation;
}

.mode-btn:hover, .mode-btn.active{
  background:rgba(255,255,255,.1);
  border-color:var(--pink);
  transform:translateX(5px);
}

.mode-icon{
  width:clamp(35px,8vw,40px);
  height:clamp(35px,8vw,40px);
  border-radius:10px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:clamp(1rem,3vw,1.2rem);
  flex-shrink:0;
}

.mode-speaking{background:var(--info-blue)}
.mode-listening{background:var(--purple)}
.mode-reading{background:var(--success-green)}
.mode-writing{background:var(--warning-orange)}
.mode-drawing{background:var(--teal)}
.mode-ai{background:var(--pink)}

.mode-info h4{
  font-size:clamp(0.9rem,2.5vw,1rem);
  margin-bottom:3px;
}

.mode-info p{
  font-size:clamp(0.7rem,2vw,0.8rem);
  opacity:.7;
}

/* MAIN CONTENT AREA */
.content-area{
  background:var(--glass-bg);
  backdrop-filter:blur(10px);
  border:1px solid var(--glass-border);
  border-radius:20px;
  padding:clamp(15px,4vw,25px);
  box-shadow:var(--shadow-glow);
  min-height:600px;
}

.content-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:25px;
  padding-bottom:20px;
  border-bottom:1px solid rgba(255,255,255,.1);
  flex-wrap:wrap;
  gap:15px;
}

.content-title{
  font-family:'Orbitron',sans-serif;
  font-size:clamp(1.1rem,4vw,1.5rem);
  display:flex;
  align-items:center;
  gap:10px;
}

.difficulty-toggle{
  display:flex;
  gap:5px;
  background:rgba(255,255,255,.1);
  padding:5px;
  border-radius:10px;
}

.diff-btn{
  padding:clamp(6px,2vw,8px) clamp(10px,3vw,15px);
  border:none;
  background:transparent;
  color:#fff;
  border-radius:8px;
  cursor:pointer;
  font-size:clamp(0.75rem,2vw,0.85rem);
  transition:all .3s;
  touch-action:manipulation;
}

.diff-btn.active{
  background:var(--pink);
  font-weight:600;
}

/* PRACTICE AREA */
.practice-container{
  display:flex;
  flex-direction:column;
  gap:20px;
}

.ai-guru{
  background:linear-gradient(135deg,rgba(155,89,182,.3),rgba(142,68,173,.3));
  border:1px solid rgba(155,89,182,.5);
  border-radius:15px;
  padding:clamp(15px,4vw,20px);
  margin-bottom:20px;
  display:flex;
  gap:15px;
  align-items:flex-start;
  flex-wrap:wrap;
}

.guru-avatar{
  width:clamp(50px,12vw,60px);
  height:clamp(50px,12vw,60px);
  background:linear-gradient(135deg,var(--purple),#8e44ad);
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:clamp(1.2rem,4vw,1.5rem);
  flex-shrink:0;
  animation:pulse 2s infinite;
}

@keyframes pulse{
  0%,100%{box-shadow:0 0 0 0 rgba(155,89,182,.4)}
  50%{box-shadow:0 0 0 15px rgba(155,89,182,0)}
}

.guru-message{
  flex:1;
  min-width:0;
}

.guru-name{
  font-weight:700;
  color:var(--purple);
  margin-bottom:5px;
  font-size:clamp(0.9rem,2.5vw,1rem);
}

.guru-text{
  line-height:1.6;
  font-size:clamp(0.9rem,2.5vw,1.05rem);
  word-wrap:break-word;
}

/* LESSON CARD */
.lesson-card{
  background:rgba(255,255,255,.05);
  border-radius:15px;
  padding:clamp(15px,4vw,25px);
  border:2px solid transparent;
  transition:all .3s;
}

.lesson-card:hover{
  border-color:var(--pink);
  transform:translateY(-3px);
}

.lesson-prompt{
  font-size:clamp(1.1rem,4vw,1.3rem);
  margin-bottom:20px;
  text-align:center;
  padding:clamp(15px,4vw,20px);
  background:rgba(255,255,255,.05);
  border-radius:10px;
  font-weight:600;
  word-wrap:break-word;
}

/* INPUT METHODS */
.input-methods{
  display:flex;
  gap:10px;
  justify-content:center;
  margin-bottom:20px;
  flex-wrap:wrap;
}

.input-btn{
  padding:clamp(10px,3vw,12px) clamp(15px,4vw,20px);
  background:rgba(255,255,255,.1);
  border:2px solid transparent;
  border-radius:10px;
  color:#fff;
  cursor:pointer;
  transition:all .3s;
  display:flex;
  align-items:center;
  gap:8px;
  font-size:clamp(0.85rem,2.5vw,1rem);
  touch-action:manipulation;
}

.input-btn:hover, .input-btn.active{
  border-color:var(--pink);
  background:rgba(255,255,255,.15);
}

/* TEXT INPUT */
.text-input-area{
  display:flex;
  gap:10px;
  margin-bottom:20px;
  flex-wrap:wrap;
}

.text-input{
  flex:1;
  min-width:0;
  padding:clamp(12px,3vw,15px);
  background:rgba(255,255,255,.1);
  border:2px solid rgba(255,255,255,.2);
  border-radius:12px;
  color:#fff;
  font-size:clamp(1rem,3vw,1.1rem);
  transition:all .3s;
}

.text-input:focus{
  outline:none;
  border-color:var(--pink);
  background:rgba(255,255,255,.15);
}

.mic-btn, .submit-btn, .calculate-btn{
  padding:clamp(12px,3vw,15px) clamp(20px,5vw,25px);
  border:none;
  border-radius:12px;
  cursor:pointer;
  transition:all .3s;
  font-size:clamp(1rem,3vw,1.1rem);
  font-weight:600;
  touch-action:manipulation;
  white-space:nowrap;
}

.mic-btn{
  background:var(--info-blue);
  color:#fff;
  flex:1;
}

.mic-btn:hover{
  background:#2980b9;
  transform:scale(1.05);
}

.mic-btn.recording{
  background:var(--pink);
  animation:pulse 1s infinite;
}

.submit-btn{
  background:var(--success-green);
  color:#fff;
}

.submit-btn:hover{
  background:#27ae60;
  transform:scale(1.05);
}

.calculate-btn{
  background:linear-gradient(135deg,var(--pink),var(--pink-light));
  color:#fff;
}

.calculate-btn:hover{
  transform:scale(1.05);
  box-shadow:0 5px 20px rgba(255,79,163,.4);
}

/* DRAWING CANVAS */
.drawing-area{
  display:none;
  flex-direction:column;
  align-items:center;
  gap:15px;
}

.drawing-area.active{
  display:flex;
}

.canvas-container{
  background:#fff;
  border-radius:15px;
  padding:10px;
  box-shadow:0 10px 30px rgba(0,0,0,.3);
  width:100%;
  max-width:420px;
  overflow:hidden;
}

#drawingCanvas{
  border-radius:10px;
  cursor:crosshair;
  touch-action:none;
  width:100%;
  height:auto;
  display:block;
}

.canvas-tools{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:center;
}

.tool-btn{
  width:clamp(35px,10vw,40px);
  height:clamp(35px,10vw,40px);
  border-radius:10px;
  border:none;
  cursor:pointer;
  transition:all .3s;
  display:flex;
  align-items:center;
  justify-content:center;
  touch-action:manipulation;
}

.tool-btn:hover{transform:scale(1.1)}
.tool-btn.active{box-shadow:0 0 0 3px var(--pink)}

.color-black{background:#2c3e50;color:#fff}
.color-red{background:#e74c3c}
.color-blue{background:#3498db}
.color-green{background:#2ecc71}

.eraser-btn{background:#95a5a6;color:#fff}
.clear-btn{background:#34495e;color:#fff}

/* FEEDBACK AREA */
.feedback-area{
  margin-top:20px;
  padding:clamp(15px,4vw,20px);
  border-radius:15px;
  display:none;
}

.feedback-area.show{
  display:block;
  animation:slideUp .5s ease;
}

@keyframes slideUp{
  from{opacity:0;transform:translateY(20px)}
  to{opacity:1;transform:translateY(0)}
}

.feedback-correct{
  background:rgba(46,204,113,.2);
  border:2px solid var(--success-green);
}

.feedback-incorrect{
  background:rgba(231,76,60,.2);
  border:2px solid var(--danger-red);
}

.feedback-header{
  display:flex;
  align-items:center;
  gap:10px;
  margin-bottom:10px;
  font-weight:700;
  font-size:clamp(1rem,3vw,1.1rem);
}

.feedback-text{
  line-height:1.6;
  margin-bottom:15px;
  font-size:clamp(0.9rem,2.5vw,1rem);
}

.feedback-tips{
  background:rgba(255,255,255,.1);
  padding:15px;
  border-radius:10px;
  font-size:clamp(0.8rem,2.5vw,0.9rem);
}

.feedback-tips h4{
  margin-bottom:8px;
  display:flex;
  align-items:center;
  gap:8px;
}

/* VOCAB GRID */
.vocab-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(min(200px,100%),1fr));
  gap:15px;
}

.vocab-card{
  background:rgba(255,255,255,.05);
  border-radius:12px;
  padding:clamp(15px,4vw,20px);
  text-align:center;
  cursor:pointer;
  transition:all .3s;
  border:2px solid transparent;
  touch-action:manipulation;
}

.vocab-card:hover{
  border-color:var(--pink);
  transform:translateY(-5px);
  background:rgba(255,255,255,.1);
}

.vocab-word{
  font-size:clamp(1.2rem,4vw,1.5rem);
  font-weight:700;
  margin-bottom:8px;
  color:var(--pink-light);
}

.vocab-translation{
  font-size:clamp(0.9rem,2.5vw,1rem);
  opacity:.8;
  margin-bottom:10px;
}

.vocab-pronunciation{
  font-size:clamp(0.75rem,2vw,0.85rem);
  color:var(--info-blue);
  font-style:italic;
}

/* CONVERSATION SIMULATOR */
.chat-container{
  background:rgba(255,255,255,.05);
  border-radius:15px;
  padding:clamp(15px,4vw,20px);
  height:clamp(300px,50vh,400px);
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  gap:15px;
  margin-bottom:15px;
}

.chat-message{
  max-width:85%;
  padding:clamp(12px,3vw,15px);
  border-radius:15px;
  line-height:1.5;
  font-size:clamp(0.85rem,2.5vw,1rem);
  word-wrap:break-word;
}

.chat-ai{
  background:linear-gradient(135deg,var(--purple),#8e44ad);
  align-self:flex-start;
  border-bottom-left-radius:5px;
}

.chat-user{
  background:linear-gradient(135deg,var(--pink),var(--pink-light));
  align-self:flex-end;
  border-bottom-right-radius:5px;
}

.chat-input-area{
  display:flex;
  gap:10px;
}

.chat-input{
  flex:1;
  min-width:0;
  padding:clamp(12px,3vw,15px);
  background:rgba(255,255,255,.1);
  border:2px solid rgba(255,255,255,.2);
  border-radius:12px;
  color:#fff;
  font-size:clamp(0.9rem,2.5vw,1rem);
}

.chat-send{
  padding:clamp(12px,3vw,15px) clamp(20px,5vw,25px);
  background:var(--pink);
  border:none;
  border-radius:12px;
  color:#fff;
  cursor:pointer;
  transition:all .3s;
  touch-action:manipulation;
}

.chat-send:hover{
  transform:scale(1.05);
  box-shadow:0 5px 20px rgba(255,79,163,.4);
}

/* QUICK TIPS */
.tips-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(min(300px,100%),1fr));
  gap:15px;
  margin-top:20px;
}

.tip-card{
  background:rgba(255,255,255,.05);
  border-radius:12px;
  padding:clamp(12px,3vw,15px);
  border-left:4px solid var(--pink);
}

.tip-title{
  font-weight:700;
  margin-bottom:8px;
  display:flex;
  align-items:center;
  gap:8px;
  font-size:clamp(0.9rem,2.5vw,0.95rem);
}

.tip-text{
  font-size:clamp(0.8rem,2.5vw,0.85rem);
  opacity:.9;
  line-height:1.5;
}

/* FLOATING BUTTON */
.fab{
  position:fixed;
  bottom:clamp(20px,5vw,30px);
  right:clamp(20px,5vw,30px);
  width:clamp(50px,12vw,60px);
  height:clamp(50px,12vw,60px);
  background:linear-gradient(135deg,var(--purple),#8e44ad);
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:clamp(20px,5vw,24px);
  color:#fff;
  border:none;
  cursor:pointer;
  box-shadow:0 8px 24px rgba(155,89,182,.5);
  transition:all .3s;
  z-index:100;
  touch-action:manipulation;
}

.fab:hover{
  transform:scale(1.1) rotate(90deg);
}

/* TOAST */
.toast{
  position:fixed;
  top:100px;
  right:20px;
  background:rgba(0,0,0,.9);
  color:#fff;
  padding:16px 24px;
  border-radius:12px;
  display:flex;
  align-items:center;
  gap:12px;
  opacity:0;
  transform:translateX(100px);
  transition:all .3s;
  z-index:3000;
  border:1px solid var(--pink);
  max-width:min(400px,90vw);
  font-size:clamp(0.9rem,2.5vw,1rem);
}

.toast.show{
  opacity:1;
  transform:translateX(0);
}

/* RESPONSIVE BREAKPOINTS */
@media(max-width:1024px){
  .dashboard{
    grid-template-columns:1fr;
  }
  
  .sidebar{
    order:2;
  }
  
  .content-area{
    order:1;
    min-height:auto;
  }
  
  .learning-modes{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(min(250px,100%),1fr));
  }
}

@media(max-width:768px){
  .header-left .motto{display:none;}
  
  .content-header{
    flex-direction:column;
    align-items:flex-start;
  }
  
  .difficulty-toggle{
    width:100%;
    justify-content:stretch;
  }
  
  .diff-btn{
    flex:1;
    text-align:center;
  }
  
  .ai-guru{
    flex-direction:column;
    text-align:center;
  }
  
  .guru-avatar{
    margin:0 auto;
  }
  
  .text-input-area{
    flex-direction:column;
  }
  
  .mic-btn, .submit-btn{
    width:100%;
  }
  
  .chat-input-area{
    flex-direction:column;
  }
  
  .chat-send{
    width:100%;
  }
  
  .canvas-container{
    padding:5px;
  }
}

@media(max-width:480px){
  .lang-selector{
    gap:8px;
  }
  
  .lang-btn{
    min-width:calc(50% - 4px);
    padding:10px;
  }
  
  .tips-grid{
    grid-template-columns:1fr;
  }
  
  .vocab-grid{
    grid-template-columns:1fr;
  }
}

/* Touch device optimizations */
@media(hover:none) and (pointer:coarse){
  .lang-btn:hover,
  .mode-btn:hover,
  .input-btn:hover,
  .vocab-card:hover{
    transform:none;
  }
  
  .lang-btn:active,
  .mode-btn:active,
  .input-btn:active,
  .vocab-card:active{
    transform:scale(0.98);
  }
}

/* Safe area for notched phones */
@supports(padding:max(0px)){
  header{
    padding-left:max(clamp(15px,4vw,26px),env(safe-area-inset-left));
    padding-right:max(clamp(15px,4vw,26px),env(safe-area-inset-right));
  }
  
  main{
    padding-left:max(clamp(10px,3vw,20px),env(safe-area-inset-left));
    padding-right:max(clamp(10px,3vw,20px),env(safe-area-inset-right));
    padding-bottom:max(clamp(10px,3vw,20px),env(safe-area-inset-bottom));
  }
  
  .fab{
    bottom:max(clamp(20px,5vw,30px),env(safe-area-inset-bottom));
    right:max(clamp(20px,5vw,30px),env(safe-area-inset-right));
  }
}
</style>
</head>

<body>

<audio id="bgMusic" src="coffee.mp3" loop></audio>
<audio id="notifSound" src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTGH0fPTgjMGHm7A7+OZURE" preload="auto"></audio>

<div id="loader">
  <div class="loader-content">
    <img src="adminlogo.png" alt="Logo">
    <div class="arc-spinner"></div>
  </div>
</div>

<header>
  <div class="header-left">
    <a href="homepage.html"><img src="adminlogo.png" alt="Logo"></a>
    <div class="motto" id="motto"></div>
  </div>
  <div class="header-icons">
    <a href="homepage.html" title="Home" id="homeLink">
      <i class="fas fa-home"></i>
      <span class="notification-badge" id="notifBadge">0</span>
    </a>
    <a id="musicToggle" title="Toggle Music"><i class="fas fa-music"></i></a>
  </div>
</header>

<main>
  <!-- WELCOME SECTION -->
  <section class="welcome-section">
    <h1><i class="fas fa-brain" style="color:var(--purple)"></i> Julie's AI Language Guru</h1>
    <p>Your personal AI language teacher that adapts to your learning style. Speak, write, draw, or chat - learn any language the way that works best for you!</p>
    
    <div class="lang-selector">
      <button class="lang-btn active" onclick="selectLanguage('korean')" data-lang="korean">
        <span class="lang-flag">ðŸ‡°ðŸ‡·</span>
        <span class="lang-name">Korean</span>
      </button>
      <button class="lang-btn" onclick="selectLanguage('japanese')" data-lang="japanese">
        <span class="lang-flag">ðŸ‡¯ðŸ‡µ</span>
        <span class="lang-name">Japanese</span>
      </button>
      <button class="lang-btn" onclick="selectLanguage('spanish')" data-lang="spanish">
        <span class="lang-flag">ðŸ‡ªðŸ‡¸</span>
        <span class="lang-name">Spanish</span>
      </button>
      <button class="lang-btn" onclick="selectLanguage('french')" data-lang="french">
        <span class="lang-flag">ðŸ‡«ðŸ‡·</span>
        <span class="lang-name">French</span>
      </button>
      <button class="lang-btn" onclick="selectLanguage('chinese')" data-lang="chinese">
        <span class="lang-flag">ðŸ‡¨ðŸ‡³</span>
        <span class="lang-name">Chinese</span>
      </button>
      <button class="lang-btn" onclick="selectLanguage('german')" data-lang="german">
        <span class="lang-flag">ðŸ‡©ðŸ‡ª</span>
        <span class="lang-name">German</span>
      </button>
    </div>
  </section>

  <!-- DASHBOARD -->
  <div class="dashboard">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="progress-card">
        <div class="progress-header">
          <span class="progress-title">Overall Progress</span>
          <div class="streak-badge">
            <i class="fas fa-fire"></i> <span id="streakCount">5</span> days
          </div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="overallProgress" style="width:35%"></div>
        </div>
        <div class="level-info">
          <span>Level <span id="levelNum">3</span></span>
          <span><span id="xpCount">350</span>/<span id="xpMax">1000</span> XP</span>
        </div>
      </div>

      <div class="progress-card">
        <div class="progress-title" style="margin-bottom:15px;">Skill Breakdown</div>
        
        <div class="skill-item">
          <div class="skill-label">
            <span><i class="fas fa-microphone"></i> Speaking</span>
            <span id="speakingPct">40%</span>
          </div>
          <div class="skill-bar">
            <div class="skill-fill skill-speaking" id="speakingBar" style="width:40%"></div>
          </div>
        </div>
        
        <div class="skill-item">
          <div class="skill-label">
            <span><i class="fas fa-headphones"></i> Listening</span>
            <span id="listeningPct">35%</span>
          </div>
          <div class="skill-bar">
            <div class="skill-fill skill-listening" id="listeningBar" style="width:35%"></div>
          </div>
        </div>
        
        <div class="skill-item">
          <div class="skill-label">
            <span><i class="fas fa-book-open"></i> Reading</span>
            <span id="readingPct">30%</span>
          </div>
          <div class="skill-bar">
            <div class="skill-fill skill-reading" id="readingBar" style="width:30%"></div>
          </div>
        </div>
        
        <div class="skill-item">
          <div class="skill-label">
            <span><i class="fas fa-pen"></i> Writing</span>
            <span id="writingPct">25%</span>
          </div>
          <div class="skill-bar">
            <div class="skill-fill skill-writing" id="writingBar" style="width:25%"></div>
          </div>
        </div>
      </div>

      <div class="learning-modes">
        <button class="mode-btn active" onclick="switchMode('speak')" data-mode="speak">
          <div class="mode-icon mode-speaking"><i class="fas fa-microphone"></i></div>
          <div class="mode-info">
            <h4>Speech Practice</h4>
            <p>Talk with AI feedback</p>
          </div>
        </button>
        
        <button class="mode-btn" onclick="switchMode('listen')" data-mode="listen">
          <div class="mode-icon mode-listening"><i class="fas fa-headphones"></i></div>
          <div class="mode-info">
            <h4>Listening</h4>
            <p>Audio comprehension</p>
          </div>
        </button>
        
        <button class="mode-btn" onclick="switchMode('vocab')" data-mode="vocab">
          <div class="mode-icon mode-reading"><i class="fas fa-book"></i></div>
          <div class="mode-info">
            <h4>Vocabulary</h4>
            <p>Flashcards & memory</p>
          </div>
        </button>
        
        <button class="mode-btn" onclick="switchMode('write')" data-mode="write">
          <div class="mode-icon mode-writing"><i class="fas fa-keyboard"></i></div>
          <div class="mode-info">
            <h4>Typing Practice</h4>
            <p>Write & translate</p>
          </div>
        </button>
        
        <button class="mode-btn" onclick="switchMode('draw')" data-mode="draw">
          <div class="mode-icon mode-drawing"><i class="fas fa-pencil-alt"></i></div>
          <div class="mode-info">
            <h4>Character Drawing</h4>
            <p>For Asian languages</p>
          </div>
        </button>
        
        <button class="mode-btn" onclick="switchMode('chat')" data-mode="chat">
          <div class="mode-icon mode-ai"><i class="fas fa-robot"></i></div>
          <div class="mode-info">
            <h4>AI Conversation</h4>
            <p>Natural dialogue</p>
          </div>
        </button>
      </div>
    </aside>

    <!-- MAIN CONTENT -->
    <div class="content-area" id="contentArea">
      <!-- Content dynamically loaded here -->
    </div>
  </div>

  <!-- QUICK TIPS -->
  <div class="tips-grid">
    <div class="tip-card">
      <div class="tip-title"><i class="fas fa-lightbulb" style="color:var(--warning-orange)"></i> Spaced Repetition</div>
      <div class="tip-text">Review words at increasing intervals (1 day, 3 days, 1 week) to move them to long-term memory.</div>
    </div>
    <div class="tip-card">
      <div class="tip-title"><i class="fas fa-ear-listen" style="color:var(--info-blue)"></i> Shadowing Technique</div>
      <div class="tip-text">Listen and repeat immediately, mimicking native speaker pronunciation and rhythm.</div>
    </div>
    <div class="tip-card">
      <div class="tip-title"><i class="fas fa-image" style="color:var(--success-green)"></i> Visualization</div>
      <div class="tip-text">Create mental images for words. Associate "ê°•ì•„ì§€" (gangaji) with a cute puppy image.</div>
    </div>
    <div class="tip-card">
      <div class="tip-title"><i class="fas fa-comments" style="color:var(--pink)"></i> Speak from Day 1</div>
      <div class="tip-text">Don't wait until you're "ready". Start speaking immediately, mistakes are part of learning!</div>
    </div>
  </div>
</main>

<button class="fab" onclick="getDailyTip()" title="Daily Learning Tip">
  <i class="fas fa-magic"></i>
</button>

<div class="toast" id="toast">
  <i class="fas fa-check-circle"></i>
  <span id="toastMsg">Great job!</span>
</div>

<script>
// Data Persistence Manager
const DataManager = {
  storageKey: 'julieLanguageGuruData',
  
  getDefaultData() {
    return {
      currentLang: 'korean',
      currentMode: 'speak',
      currentLesson: 0,
      progress: {
        overall: 35,
        xp: 350,
        xpMax: 1000,
        level: 3,
        streak: 5,
        skills: {
          speaking: 40,
          listening: 35,
          reading: 30,
          writing: 25
        }
      },
      notifications: [],
      lastVisit: new Date().toISOString(),
      chatHistory: [],
      lessonProgress: {}
    };
  },
  
  load() {
    try {
      const saved = localStorage.getItem(this.storageKey);
      if (saved) {
        const data = JSON.parse(saved);
        // Merge with defaults to ensure new fields exist
        return {...this.getDefaultData(), ...data};
      }
    } catch (e) {
      console.error('Error loading data:', e);
    }
    return this.getDefaultData();
  },
  
  save(data) {
    try {
      const dataToSave = {
        ...data,
        lastVisit: new Date().toISOString()
      };
      localStorage.setItem(this.storageKey, JSON.stringify(dataToSave));
      this.broadcastUpdate(dataToSave);
    } catch (e) {
      console.error('Error saving data:', e);
    }
  },
  
  broadcastUpdate(data) {
    // Broadcast to other tabs/windows
    if (typeof BroadcastChannel !== 'undefined') {
      const bc = new BroadcastChannel('julie_language_guru');
      bc.postMessage({type: 'dataUpdate', data});
    }
    // Custom event for same window
    window.dispatchEvent(new CustomEvent('julieDataUpdate', {detail: data}));
  },
  
  clear() {
    localStorage.removeItem(this.storageKey);
  }
};

// App State
let appData = DataManager.load();
let currentLang = appData.currentLang;
let currentMode = appData.currentMode;
let currentLesson = appData.currentLesson;
let recognition;
let notifications = appData.notifications || [];

// Language Data
const langData = {
  korean: {
    name: 'Korean',
    greeting: 'ì•ˆë…•í•˜ì„¸ìš” (Annyeonghaseyo)',
    lessons: [
      {type: 'speak', prompt: 'Say "Hello" in Korean', answer: 'ì•ˆë…•í•˜ì„¸ìš”', alternatives: ['annyeonghaseyo', 'annyonghaseyo']},
      {type: 'speak', prompt: 'Say "Thank you" in Korean', answer: 'ê°ì‚¬í•©ë‹ˆë‹¤', alternatives: ['gamsahamnida', 'kamsahamnida']},
      {type: 'vocab', words: [
        {word: 'ì‚¬ëž‘', translation: 'Love', pronunciation: 'sarang'},
        {word: 'ì¹œêµ¬', translation: 'Friend', pronunciation: 'chingu'},
        {word: 'í–‰ë³µ', translation: 'Happiness', pronunciation: 'haengbok'},
        {word: 'ê¿ˆ', translation: 'Dream', pronunciation: 'kkum'},
        {word: 'ë¹›', translation: 'Light', pronunciation: 'bit'},
        {word: 'ë°”ë‹¤', translation: 'Sea', pronunciation: 'bada'}
      ]}
    ],
    chatStarters: ['ì•ˆë…•! ì´ë¦„ì´ ë­ì˜ˆìš”?', 'ì˜¤ëŠ˜ ê¸°ë¶„ì´ ì–´ë•Œìš”?', 'í•œêµ­ì–´ë¥¼ ë°°ìš°ê³  ìžˆì–´ìš”']
  },
  japanese: {
    name: 'Japanese',
    greeting: 'ã“ã‚“ã«ã¡ã¯ (Konnichiwa)',
    lessons: [
      {type: 'speak', prompt: 'Say "Hello" in Japanese', answer: 'ã“ã‚“ã«ã¡ã¯', alternatives: ['konnichiwa', 'konichiwa']},
      {type: 'speak', prompt: 'Say "Thank you" in Japanese', answer: 'ã‚ã‚ŠãŒã¨ã†', alternatives: ['arigatou', 'arigato']},
      {type: 'vocab', words: [
        {word: 'æ„›', translation: 'Love', pronunciation: 'ai'},
        {word: 'å‹é”', translation: 'Friend', pronunciation: 'tomodachi'},
        {word: 'å¹¸ã›', translation: 'Happiness', pronunciation: 'shiawase'},
        {word: 'å¤¢', translation: 'Dream', pronunciation: 'yume'},
        {word: 'å…‰', translation: 'Light', pronunciation: 'hikari'},
        {word: 'æµ·', translation: 'Sea', pronunciation: 'umi'}
      ]}
    ],
    chatStarters: ['ã“ã‚“ã«ã¡ã¯ï¼ãŠå…ƒæ°—ã§ã™ã‹ï¼Ÿ', 'æ—¥æœ¬èªžã‚’å‹‰å¼·ã—ã¦ã„ã¾ã™', 'å¥½ããªé£Ÿã¹ç‰©ã¯ä½•ã§ã™ã‹ï¼Ÿ']
  },
  spanish: {
    name: 'Spanish',
    greeting: 'Hola',
    lessons: [
      {type: 'speak', prompt: 'Say "Hello" in Spanish', answer: 'Hola', alternatives: ['ola']},
      {type: 'speak', prompt: 'Say "Thank you" in Spanish', answer: 'Gracias', alternatives: ['gracias']},
      {type: 'vocab', words: [
        {word: 'Amor', translation: 'Love', pronunciation: 'ah-MOR'},
        {word: 'Amigo', translation: 'Friend', pronunciation: 'ah-MEE-goh'},
        {word: 'Felicidad', translation: 'Happiness', pronunciation: 'feh-lee-see-DAHD'},
        {word: 'SueÃ±o', translation: 'Dream', pronunciation: 'SWEH-nyoh'},
        {word: 'Luz', translation: 'Light', pronunciation: 'loos'},
        {word: 'Mar', translation: 'Sea', pronunciation: 'mahr'}
      ]}
    ],
    chatStarters: ['Â¡Hola! Â¿CÃ³mo estÃ¡s?', 'Estoy aprendiendo espaÃ±ol', 'Â¿De dÃ³nde eres?']
  },
  french: {
    name: 'French',
    greeting: 'Bonjour',
    lessons: [
      {type: 'speak', prompt: 'Say "Hello" in French', answer: 'Bonjour', alternatives: ['bonjour']},
      {type: 'speak', prompt: 'Say "Thank you" in French', answer: 'Merci', alternatives: ['merci']},
      {type: 'vocab', words: [
        {word: 'Amour', translation: 'Love', pronunciation: 'ah-MOOR'},
        {word: 'Ami', translation: 'Friend', pronunciation: 'ah-MEE'},
        {word: 'Bonheur', translation: 'Happiness', pronunciation: 'bon-URH'},
        {word: 'RÃªve', translation: 'Dream', pronunciation: 'REHV'},
        {word: 'LumiÃ¨re', translation: 'Light', pronunciation: 'loo-MYEHR'},
        {word: 'Mer', translation: 'Sea', pronunciation: 'mehr'}
      ]}
    ],
    chatStarters: ['Bonjour ! Comment allez-vous ?', 'J\'apprends le franÃ§ais', 'Qu\'est-ce que vous aimez faire ?']
  },
  chinese: {
    name: 'Chinese',
    greeting: 'ä½ å¥½ (NÇ hÇŽo)',
    lessons: [
      {type: 'speak', prompt: 'Say "Hello" in Chinese', answer: 'ä½ å¥½', alternatives: ['ni hao', 'nihao']},
      {type: 'speak', prompt: 'Say "Thank you" in Chinese', answer: 'è°¢è°¢', alternatives: ['xie xie', 'xiexie']},
      {type: 'vocab', words: [
        {word: 'çˆ±', translation: 'Love', pronunciation: 'Ã i'},
        {word: 'æœ‹å‹', translation: 'Friend', pronunciation: 'pÃ©ngyou'},
        {word: 'å¹¸ç¦', translation: 'Happiness', pronunciation: 'xÃ¬ngfÃº'},
        {word: 'æ¢¦æƒ³', translation: 'Dream', pronunciation: 'mÃ¨ngxiÇŽng'},
        {word: 'å…‰', translation: 'Light', pronunciation: 'guÄng'},
        {word: 'æµ·', translation: 'Sea', pronunciation: 'hÇŽi'}
      ]}
    ],
    chatStarters: ['ä½ å¥½ï¼ä½ å¥½å—ï¼Ÿ', 'æˆ‘åœ¨å­¦ä¸­æ–‡', 'ä½ å–œæ¬¢åƒä»€ä¹ˆï¼Ÿ']
  },
  german: {
    name: 'German',
    greeting: 'Hallo',
    lessons: [
      {type: 'speak', prompt: 'Say "Hello" in German', answer: 'Hallo', alternatives: ['hallo']},
      {type: 'speak', prompt: 'Say "Thank you" in German', answer: 'Danke', alternatives: ['danke', 'dankeschÃ¶n']},
      {type: 'vocab', words: [
        {word: 'Liebe', translation: 'Love', pronunciation: 'LEE-buh'},
        {word: 'Freund', translation: 'Friend', pronunciation: 'FROIND'},
        {word: 'GlÃ¼ck', translation: 'Happiness', pronunciation: 'gluhk'},
        {word: 'Traum', translation: 'Dream', pronunciation: 'trowm'},
        {word: 'Licht', translation: 'Light', pronunciation: 'likht'},
        {word: 'Meer', translation: 'Sea', pronunciation: 'mair'}
      ]}
    ],
    chatStarters: ['Hallo! Wie geht\'s?', 'Ich lerne Deutsch', 'Was machst du gerne?']
  }
};

// Notification System
const NotificationSystem = {
  add(message, type = 'info') {
    const notif = {
      id: Date.now(),
      message,
      type,
      timestamp: new Date().toISOString(),
      read: false
    };
    notifications.unshift(notif);
    appData.notifications = notifications;
    DataManager.save(appData);
    this.updateBadge();
    this.playSound();
    showToast(message);
  },
  
  clear() {
    notifications = [];
    appData.notifications = notifications;
    DataManager.save(appData);
    this.updateBadge();
  },
  
  markAllRead() {
    notifications.forEach(n => n.read = true);
    appData.notifications = notifications;
    DataManager.save(appData);
    this.updateBadge();
  },
  
  getUnreadCount() {
    return notifications.filter(n => !n.read).length;
  },
  
  updateBadge() {
    const badge = document.getElementById('notifBadge');
    const count = this.getUnreadCount();
    if (count > 0) {
      badge.textContent = count > 99 ? '99+' : count;
      badge.classList.add('show');
    } else {
      badge.classList.remove('show');
    }
  },
  
  playSound() {
    const sound = document.getElementById('notifSound');
    if (sound) {
      sound.currentTime = 0;
      sound.play().catch(e => console.log('Audio play failed:', e));
    }
  }
};

// Initialize
window.addEventListener('load', () => {
  setTimeout(() => document.getElementById('loader').classList.add('fade-out'), 250);
  
  // Restore UI state
  restoreUIState();
  
  // Load saved progress
  loadSavedProgress();
  
  // Initialize mode
  loadMode(currentMode);
  initSpeechRecognition();
  
  // Check for notifications
  NotificationSystem.updateBadge();
  
  // Setup real-time sync
  setupRealtimeSync();
  
  // Welcome back notification if it's been a while
  checkWelcomeBack();
});

// Restore UI state from saved data
function restoreUIState() {
  // Restore language selection
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.classList.remove('active');
    if (btn.dataset.lang === currentLang) {
      btn.classList.add('active');
    }
  });
  
  // Restore mode selection
  document.querySelectorAll('.mode-btn').forEach(btn => {
    btn.classList.remove('active');
    if (btn.dataset.mode === currentMode) {
      btn.classList.add('active');
    }
  });
}

// Load saved progress into UI
function loadSavedProgress() {
  const p = appData.progress;
  document.getElementById('overallProgress').style.width = p.overall + '%';
  document.getElementById('xpCount').textContent = p.xp;
  document.getElementById('xpMax').textContent = p.xpMax;
  document.getElementById('levelNum').textContent = p.level;
  document.getElementById('streakCount').textContent = p.streak;
  
  // Load skills
  document.getElementById('speakingPct').textContent = p.skills.speaking + '%';
  document.getElementById('speakingBar').style.width = p.skills.speaking + '%';
  document.getElementById('listeningPct').textContent = p.skills.listening + '%';
  document.getElementById('listeningBar').style.width = p.skills.listening + '%';
  document.getElementById('readingPct').textContent = p.skills.reading + '%';
  document.getElementById('readingBar').style.width = p.skills.reading + '%';
  document.getElementById('writingPct').textContent = p.skills.writing + '%';
  document.getElementById('writingBar').style.width = p.skills.writing + '%';
}

// Setup real-time synchronization
function setupRealtimeSync() {
  // Listen for storage changes (other tabs)
  window.addEventListener('storage', (e) => {
    if (e.key === DataManager.storageKey) {
      const newData = JSON.parse(e.newValue);
      if (newData) {
        appData = newData;
        loadSavedProgress();
        NotificationSystem.updateBadge();
      }
    }
  });
  
  // Listen for broadcast channel updates
  if (typeof BroadcastChannel !== 'undefined') {
    const bc = new BroadcastChannel('julie_language_guru');
    bc.onmessage = (event) => {
      if (event.data.type === 'dataUpdate') {
        appData = event.data.data;
        loadSavedProgress();
        NotificationSystem.updateBadge();
      }
    };
  }
  
  // Listen for custom events (same window)
  window.addEventListener('julieDataUpdate', (e) => {
    // Data updated in this window
  });
}

// Check for welcome back notification
function checkWelcomeBack() {
  const lastVisit = new Date(appData.lastVisit);
  const now = new Date();
  const hoursSince = (now - lastVisit) / (1000 * 60 * 60);
  
  if (hoursSince > 24) {
    NotificationSystem.add(`Welcome back! You have a ${appData.progress.streak} day streak! Keep it up! ðŸ”¥`, 'welcome');
  }
}

// Speech Recognition Setup
function initSpeechRecognition() {
  if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SpeechRecognition();
    recognition.continuous = false;
    recognition.interimResults = false;
    updateRecognitionLang();
    
    recognition.onresult = (event) => {
      const transcript = event.results[0][0].transcript;
      checkAnswer(transcript);
    };
    
    recognition.onerror = (event) => {
      console.error('Speech recognition error', event.error);
      showToast('Could not hear you. Please try again!');
    };
  }
}

function updateRecognitionLang() {
  if (recognition) {
    const langCodes = {
      korean: 'ko-KR', japanese: 'ja-JP', spanish: 'es-ES',
      french: 'fr-FR', chinese: 'zh-CN', german: 'de-DE'
    };
    recognition.lang = langCodes[currentLang] || 'en-US';
  }
}

// Motto
const titles = [
  ['fas fa-brain', 'Master languages, master the world'],
  ['fas fa-graduation-cap', 'Every word is a new door'],
  ['fas fa-globe', 'Speak to the world, Julie!'],
  ['fas fa-star', 'Your accent is your superpower']
];
const t = titles[Math.floor(Math.random() * titles.length)];
document.getElementById('motto').innerHTML = `<i class="${t[0]}"></i> ${t[1]}`;

// Music
let musicOn = false;
document.getElementById('musicToggle').onclick = () => {
  musicOn = !musicOn;
  const audio = document.getElementById('bgMusic');
  musicOn ? audio.play() : audio.pause();
  document.getElementById('musicToggle').style.background = musicOn ? 'rgba(255,255,255,.3)' : '';
};

// Language Selection
function selectLanguage(lang) {
  currentLang = lang;
  appData.currentLang = lang;
  
  document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
  event.target.closest('.lang-btn').classList.add('active');
  
  currentLesson = 0;
  appData.currentLesson = 0;
  
  DataManager.save(appData);
  loadMode(currentMode);
  updateRecognitionLang();
  
  showToast(`Switched to ${langData[lang].name}! ðŸŒ`);
  NotificationSystem.add(`Started learning ${langData[lang].name}! Good luck! ðŸŽ¯`, 'lang');
}

// Mode Switching
function switchMode(mode) {
  currentMode = mode;
  appData.currentMode = mode;
  
  document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
  event.target.closest('.mode-btn').classList.add('active');
  
  DataManager.save(appData);
  loadMode(mode);
}

function loadMode(mode) {
  const content = document.getElementById('contentArea');
  const data = langData[currentLang];
  
  switch(mode) {
    case 'speak':
      renderSpeakMode(content, data);
      break;
    case 'listen':
      renderListenMode(content, data);
      break;
    case 'vocab':
      renderVocabMode(content, data);
      break;
    case 'write':
      renderWriteMode(content, data);
      break;
    case 'draw':
      renderDrawMode(content);
      break;
    case 'chat':
      renderChatMode(content, data);
      break;
  }
}

// SPEAK MODE
function renderSpeakMode(container, data) {
  const lesson = data.lessons[currentLesson % data.lessons.length];
  container.innerHTML = `
    <div class="content-header">
      <div class="content-title"><i class="fas fa-microphone"></i> Speech Practice</div>
      <div class="difficulty-toggle">
        <button class="diff-btn active">Easy</button>
        <button class="diff-btn">Medium</button>
        <button class="diff-btn">Hard</button>
      </div>
    </div>
    
    <div class="practice-container">
      <div class="ai-guru">
        <div class="guru-avatar"><i class="fas fa-robot"></i></div>
        <div class="guru-message">
          <div class="guru-name">AI Guru</div>
          <div class="guru-text">Listen and repeat! I'll check your pronunciation. Say this in ${data.name}:<br><br>
          <strong style="font-size:clamp(1.1rem,4vw,1.3rem);color:var(--pink-light);display:block;margin-top:10px;">"${lesson.prompt.replace('Say ', '').replace(` in ${data.name}`, '')}"</strong></div>
        </div>
      </div>
      
      <div class="lesson-card">
        <div class="lesson-prompt">
          <i class="fas fa-volume-up" style="cursor:pointer;" onclick="speakText('${lesson.answer}')"></i> 
          Click to hear: "${lesson.answer}"
        </div>
        
        <div class="input-methods">
          <button class="input-btn active" onclick="toggleInput('voice')"><i class="fas fa-microphone"></i> Voice</button>
          <button class="input-btn" onclick="toggleInput('text')"><i class="fas fa-keyboard"></i> Type</button>
        </div>
        
        <div class="text-input-area" id="voiceInput">
          <button class="mic-btn" id="micBtn" ontouchstart="startRecording()" onmousedown="startRecording()" ontouchend="stopRecording()" onmouseup="stopRecording()">
            <i class="fas fa-microphone"></i> Hold to Speak
          </button>
        </div>
        
        <div class="text-input-area" id="textInput" style="display:none;">
          <input type="text" class="text-input" id="typeAnswer" placeholder="Type your answer...">
          <button class="submit-btn" onclick="checkTypedAnswer()">Check</button>
        </div>
        
        <div class="feedback-area" id="feedbackArea"></div>
      </div>
    </div>
  `;
}

function toggleInput(type) {
  document.querySelectorAll('.input-btn').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
  document.getElementById('voiceInput').style.display = type === 'voice' ? 'flex' : 'none';
  document.getElementById('textInput').style.display = type === 'text' ? 'flex' : 'none';
}

function startRecording() {
  if (!recognition) {
    showToast('Speech recognition not supported in your browser');
    return;
  }
  
  const btn = document.getElementById('micBtn');
  btn.classList.add('recording');
  btn.innerHTML = '<i class="fas fa-circle"></i> Listening...';
  
  recognition.start();
}

function stopRecording() {
  if (!recognition) return;
  
  const btn = document.getElementById('micBtn');
  btn.classList.remove('recording');
  btn.innerHTML = '<i class="fas fa-microphone"></i> Hold to Speak';
  
  recognition.stop();
}

function checkAnswer(transcript) {
  const data = langData[currentLang];
  const lesson = data.lessons[currentLesson % data.lessons.length];
  const normalized = transcript.toLowerCase().trim();
  const isCorrect = normalized === lesson.answer.toLowerCase() || 
                    lesson.alternatives.some(alt => normalized === alt.toLowerCase());
  
  showFeedback(isCorrect, lesson.answer, transcript);
  if (isCorrect) {
    updateProgress(10);
    updateSkill('speaking', 5);
    setTimeout(() => {
      currentLesson++;
      appData.currentLesson = currentLesson;
      DataManager.save(appData);
      loadMode('speak');
    }, 2000);
  }
}

function checkTypedAnswer() {
  const answer = document.getElementById('typeAnswer').value;
  checkAnswer(answer);
}

function showFeedback(isCorrect, correct, attempt) {
  const area = document.getElementById('feedbackArea');
  area.className = `feedback-area show ${isCorrect ? 'feedback-correct' : 'feedback-incorrect'}`;
  area.innerHTML = `
    <div class="feedback-header">
      <i class="fas ${isCorrect ? 'fa-check-circle' : 'fa-times-circle'}"></i>
      ${isCorrect ? 'Excellent!' : 'Not quite...'}
    </div>
    <div class="feedback-text">
      ${isCorrect ? 'Perfect pronunciation! Keep it up!' : `You said: "${attempt}"<br>Correct: "${correct}"`}
    </div>
    ${!isCorrect ? `
    <div class="feedback-tips">
      <h4><i class="fas fa-lightbulb"></i> Tip</h4>
      Listen carefully to the rhythm and intonation. Try breaking it into syllables.
    </div>
    ` : ''}
  `;
}

// LISTEN MODE
function renderListenMode(container, data) {
  container.innerHTML = `
    <div class="content-header">
      <div class="content-title"><i class="fas fa-headphones"></i> Listening Practice</div>
    </div>
    <div class="practice-container">
      <div class="ai-guru">
        <div class="guru-avatar"><i class="fas fa-ear-listen"></i></div>
        <div class="guru-message">
          <div class="guru-name">Listening Challenge</div>
          <div class="guru-text">Listen to the audio and select what you heard. Train your ear to recognize native speech!</div>
        </div>
      </div>
      
      <div class="lesson-card" style="text-align:center;padding:clamp(20px,5vw,40px);">
        <button class="calculate-btn" style="font-size:clamp(1rem,3vw,1.2rem);padding:clamp(15px,4vw,20px) clamp(30px,6vw,40px);" onclick="playListeningChallenge()">
          <i class="fas fa-play-circle"></i> Start Listening Challenge
        </button>
        <div id="listeningOptions" style="margin-top:30px;display:none;">
          <p style="margin-bottom:20px;">What did you hear?</p>
          <div style="display:flex;flex-direction:column;gap:10px;">
            <button class="input-btn" style="justify-content:center;" onclick="checkListening(0)">Option 1</button>
            <button class="input-btn" style="justify-content:center;" onclick="checkListening(1)">Option 2</button>
            <button class="input-btn" style="justify-content:center;" onclick="checkListening(2)">Option 3</button>
          </div>
        </div>
      </div>
    </div>
  `;
}

function playListeningChallenge() {
  const data = langData[currentLang];
  const phrases = ['Hello', 'Thank you', 'Good morning', 'How are you?', 'Nice to meet you'];
  const correct = phrases[Math.floor(Math.random() * phrases.length)];
  
  speakText(correct);
  document.getElementById('listeningOptions').style.display = 'block';
}

function checkListening(choice) {
  const isCorrect = choice === 0;
  showToast(isCorrect ? 'Correct! ðŸŽ‰' : 'Try again! ðŸ’ª');
  if (isCorrect) {
    updateProgress(10);
    updateSkill('listening', 5);
  }
}

// VOCAB MODE
function renderVocabMode(container, data) {
  const words = data.lessons.find(l => l.type === 'vocab').words;
  container.innerHTML = `
    <div class="content-header">
      <div class="content-title"><i class="fas fa-book"></i> Vocabulary Builder</div>
    </div>
    <div class="practice-container">
      <div class="ai-guru">
        <div class="guru-avatar"><i class="fas fa-brain"></i></div>
        <div class="guru-message">
          <div class="guru-name">Memory Master</div>
          <div class="guru-text">Click cards to flip. Say the word out loud 3 times to activate muscle memory!</div>
        </div>
      </div>
      
      <div class="vocab-grid">
        ${words.map((w, i) => `
          <div class="vocab-card" onclick="flipCard(this, '${w.word}', '${w.translation}', '${w.pronunciation}')">
            <div class="vocab-front">
              <div class="vocab-word">${w.word}</div>
              <div class="vocab-pronunciation">[${w.pronunciation}]</div>
              <div style="margin-top:10px;font-size:clamp(0.7rem,2vw,0.8rem);opacity:.6;">Click to reveal meaning</div>
            </div>
          </div>
        `).join('')}
      </div>
    </div>
  `;
}

function flipCard(card, word, translation, pronunciation) {
  if (card.classList.contains('flipped')) {
    card.classList.remove('flipped');
    card.innerHTML = `
      <div class="vocab-front">
        <div class="vocab-word">${word}</div>
        <div class="vocab-pronunciation">[${pronunciation}]</div>
        <div style="margin-top:10px;font-size:clamp(0.7rem,2vw,0.8rem);opacity:.6;">Click to reveal meaning</div>
      </div>
    `;
  } else {
    card.classList.add('flipped');
    card.innerHTML = `
      <div style="padding:clamp(10px,3vw,20px);">
        <div style="font-size:clamp(1.1rem,3.5vw,1.3rem);color:var(--success-green);margin-bottom:10px;">${translation}</div>
        <div style="font-size:clamp(0.9rem,2.5vw,1rem);margin-bottom:15px;">${word}</div>
        <button class="input-btn" onclick="event.stopPropagation();speakText('${word}')">
          <i class="fas fa-volume-up"></i> Hear Pronunciation
        </button>
      </div>
    `;
    speakText(word);
    updateProgress(5);
    updateSkill('reading', 2);
  }
}

// WRITE MODE
function renderWriteMode(container, data) {
  container.innerHTML = `
    <div class="content-header">
      <div class="content-title"><i class="fas fa-keyboard"></i> Typing Practice</div>
    </div>
    <div class="practice-container">
      <div class="ai-guru">
        <div class="guru-avatar"><i class="fas fa-pen-fancy"></i></div>
        <div class="guru-message">
          <div class="guru-name">Writing Wizard</div>
          <div class="guru-text">Type the ${data.name} translation. Pay attention to special characters!</div>
        </div>
      </div>
      
      <div class="lesson-card">
        <div class="lesson-prompt">
          Translate: <strong>"Hello"</strong>
        </div>
        <div class="text-input-area">
          <input type="text" class="text-input" id="writeAnswer" placeholder="Type in ${data.name}...">
          <button class="submit-btn" onclick="checkWriting()">Check</button>
        </div>
        <div class="feedback-area" id="writeFeedback"></div>
      </div>
    </div>
  `;
}

function checkWriting() {
  const answer = document.getElementById('writeAnswer').value;
  const correct = langData[currentLang].greeting.split(' ')[0];
  const isCorrect = answer.toLowerCase().includes(correct.toLowerCase());
  
  const feedback = document.getElementById('writeFeedback');
  feedback.className = `feedback-area show ${isCorrect ? 'feedback-correct' : 'feedback-incorrect'}`;
  feedback.innerHTML = `
    <div class="feedback-header">
      <i class="fas ${isCorrect ? 'fa-check-circle' : 'fa-times-circle'}"></i>
      ${isCorrect ? 'Perfect!' : 'Keep practicing!'}
    </div>
    <div class="feedback-text">
      ${isCorrect ? 'Great typing skills!' : `Correct answer: ${correct}`}
    </div>
  `;
  
  if (isCorrect) {
    updateProgress(10);
    updateSkill('writing', 5);
  }
}

// DRAW MODE
function renderDrawMode(container) {
  container.innerHTML = `
    <div class="content-header">
      <div class="content-title"><i class="fas fa-pencil-alt"></i> Character Drawing</div>
    </div>
    <div class="practice-container">
      <div class="ai-guru">
        <div class="guru-avatar"><i class="fas fa-hand-sparkles"></i></div>
        <div